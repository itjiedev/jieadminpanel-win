{% extends 'layout_panel.html' %}
{% block html_js_code %}
<script>
layui.use(function(){
    var form  = layui.form;
    var $ = layui.$;
    var layer = layui.layer;
    var util = layui.util;

    util.on('lay-on', {
        uninstall: function(){
            layer.confirm('确定要开始卸载吗？', {icon: 3}, function(){
            var startIndex = layer.msg('启动卸载，请根据卸载程序提示操作。。.', {
                icon: 16,
                shade: 0.6,
                time: 0,
            });
            $.ajax({
                url: '{% url 'project_python:pycharm_uninstall_run' %}',
                type: 'get',
                dataType:'json',
                success: function(response){
                    window.location.href = "{% url 'project_python:pycharm_project' %}";
                },
                error: function(xhr, status, message) {
                    let errorMsg = '操作失败: ';
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        errorMsg += xhr.responseJSON.message;
                    } else {
                        errorMsg += message;
                    }
                    layer.alert(errorMsg, {icon: 2, title:null});
                }
            })
            }, function(){})
        },
    })
})
</script>
{% endblock %}

{% block page_content %}

{% if not pycharm %}
{% include 'include_messages.html' %}
<div class="alert alert-danger">
    没有找到 Pycharm 的安装信息~
</div>
{% else %}
<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-md-1">
    <div style="width: 54px; height: 54px">
        <svg fill="none" viewBox="0 0 64 64" class="insights-section__card-logo wt-display-md-none">
            <defs>
                <linearGradient id="__JETBRAINS_COM__LOGO_PREFIX__1" x1="7.671" x2="61.126" y1="64.393" y2="39.609" gradientUnits="userSpaceOnUse"><stop offset="0.1" stop-color="#00D886"></stop><stop offset="0.59" stop-color="#F0EB18"></stop></linearGradient>
                <linearGradient id="__JETBRAINS_COM__LOGO_PREFIX__0" x1="59.933" x2="1.337" y1="59.676" y2="1.08" gradientUnits="userSpaceOnUse"><stop offset="0.3" stop-color="#F0EB18"></stop><stop offset="0.7" stop-color="#00C4F4"></stop></linearGradient>
            </defs>
            <path fill="#00D886" d="M6 47.55v12.259a4.125 4.125 0 0 0 4.19 4.124l11.044-.176a4.125 4.125 0 0 0 3.066-1.44l32.707-38.158c.64-.748.993-1.7.993-2.685V10.125A4.125 4.125 0 0 0 53.875 6H42.872c-1.19 0-2.321.514-3.105 1.409L7.021 44.834A4.123 4.123 0 0 0 6 47.55Z"></path>
            <path fill="url(#__JETBRAINS_COM__LOGO_PREFIX__1)" d="M6 49.015v10.862a4.125 4.125 0 0 0 4.125 4.125h12.566c.2 0 .4-.014.598-.044l37.185-5.448A4.125 4.125 0 0 0 64 54.429V39.03a4.125 4.125 0 0 0-4.127-4.125l-18.504.005c-.426 0-.849.066-1.254.195l-31.244 9.98A4.126 4.126 0 0 0 6 49.015Z"></path>
            <path fill="url(#__JETBRAINS_COM__LOGO_PREFIX__0)" d="M0 4.125v34.127c0 1.659.993 3.155 2.52 3.8L39.943 57.85c.518.219 1.075.33 1.638.324l18.329-.15A4.125 4.125 0 0 0 64 53.9V36.234c0-.806-.236-1.593-.678-2.267L42.213 1.86A4.125 4.125 0 0 0 38.766 0H4.125A4.125 4.125 0 0 0 0 4.125Z"></path>
            <path fill="#000" d="M52 12H12v40h40V12Z"></path><path fill="#fff" d="M33 44H17v3h16v-3ZM16.993 16.992h6.442c1.057 0 1.984.193 2.78.579.798.386 1.412.929 1.845 1.63.432.7.648 1.51.648 2.432 0 .922-.22 1.759-.659 2.466-.44.708-1.063 1.256-1.87 1.646-.808.39-1.751.584-2.83.584h-3.43V32h-2.927V16.993Zm7.54 6.63c.369-.182.652-.443.852-.782.2-.34.3-.738.3-1.195s-.1-.842-.3-1.174c-.2-.333-.484-.59-.852-.772-.368-.182-.798-.273-1.291-.273h-3.324v4.47h3.324c.493 0 .923-.091 1.291-.273Zm9.18 7.62a7.287 7.287 0 0 1-2.744-2.786c-.664-1.183-.996-2.503-.996-3.961s.332-2.778.996-3.96a7.29 7.29 0 0 1 2.744-2.787c1.165-.675 2.466-1.014 3.902-1.014 1.215 0 2.33.225 3.344.675a6.862 6.862 0 0 1 2.535 1.892 6.443 6.443 0 0 1 1.356 2.793h-3.066a4.054 4.054 0 0 0-.895-1.431 4.038 4.038 0 0 0-1.43-.95 4.896 4.896 0 0 0-1.823-.332c-.887 0-1.687.222-2.402.665a4.611 4.611 0 0 0-1.677 1.827c-.404.776-.606 1.649-.606 2.62 0 .973.202 1.846.606 2.621a4.607 4.607 0 0 0 1.677 1.828c.715.443 1.515.664 2.402.664a4.88 4.88 0 0 0 1.822-.332 4.022 4.022 0 0 0 2.326-2.38h3.066a6.444 6.444 0 0 1-1.356 2.792 6.863 6.863 0 0 1-2.535 1.892c-1.015.45-2.129.675-3.344.675-1.436 0-2.737-.337-3.902-1.013v.003Z"></path>
        </svg>
    </div>
            </div>
            <div class="col-md-11 layui-font-18 text-bold">卸载 {{ pycharm.DisplayName }}</div>
        </div>
    </div>
<form method="post" class="layui-form">{% csrf_token %}
    <div class="card-body">

        <p class="mb-1">{{ pycharm.DisplayName }} 将从以下文件夹中卸载</p>
        <p>{{ pycharm.InstallLocation }}</p>

        <p class="text-danger text-bold">请确保Pycharm没有在启动状态。点击卸载将启动 Pycharm 的卸载程序~</p>
        <p class="text-danger text-bold">如果要重装，请执行完卸载程序后再安装~~</p>
    </div>
    <div class="card-footer">
        <button type="button" href="" class="btn btn-danger" lay-on="uninstall">卸载</button>
        <a href="{% url 'project_python:pycharm_project' %}" class="btn btn-secondary float-right">取消</a>
    </div>
</form>
</div>
{% endif %}
{% endblock %}